<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Tách Authorization VIP</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    /* Biến CSS */
    :root{
      --bg-start:#050a11;
      --bg-end:#0d1829;
      --card:#1a253a;
      --accent:#00e5ff; /* Màu xanh neon/cyan sáng, sang trọng */
      --accent-hover:#00b8d4;
      --text-main:#f0f4f8;
      --text-muted:#8898b5;
      --border-color:rgba(0,229,255,0.15); /* Viền màu accent nhạt */
    }

    /* Thiết lập cơ bản */
    *{box-sizing:border-box}
    body{
      font-family:'Inter', sans-serif;
      margin:0;
      background:radial-gradient(ellipse at top, var(--bg-start) 0%, var(--bg-end) 100%);
      color:var(--text-main);
      padding:25px 20px;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:flex-start; /* Giữ nội dung ở trên cùng */
    }
    .container{
      width:100%;
      max-width:550px; /* Hẹp hơn để tập trung */
    }
    h1{
      margin:0 0 8px;
      font-size:26px;
      font-weight:800;
      color:var(--accent);
      text-align:center;
      letter-spacing:1px;
      text-shadow:0 0 8px rgba(0,229,255,0.3); /* Hiệu ứng neon nhẹ */
    }
    p{
      margin:0 0 25px;
      color:var(--text-muted);
      text-align:center;
      font-size:14px;
    }

    /* Thẻ chính */
    .card{
      background:var(--card);
      padding:20px;
      border-radius:12px;
      box-shadow:0 10px 30px rgba(0,0,0,0.5);
      margin-bottom:20px;
      border:1px solid var(--border-color);
    }
    
    /* Input Area */
    textarea{
      width:100%;
      min-height:120px;
      padding:15px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.1);
      background:rgba(0,0,0,0.2);
      color:var(--text-main);
      font-family:monospace;
      font-size:14px;
      resize:vertical;
      transition:border-color 0.3s, box-shadow 0.3s;
    }
    textarea:focus{
      outline:none;
      border-color:var(--accent);
      box-shadow:0 0 10px rgba(0,229,255,0.5);
    }

    /* Kết quả & Nút Copy */
    .output-label{
        font-size:13px;
        color:var(--text-muted);
        margin-bottom:10px;
        display:flex;
        justify-content:space-between;
        align-items:center;
    }

    .auth-output{
      padding:12px;
      margin-bottom:15px;
      border-radius:8px;
      border:1px dashed var(--border-color);
      background:rgba(0,0,0,0.15);
      font-family:monospace;
      font-size:14px;
      word-break:break-all;
      min-height:45px;
      display:block;
      cursor:text; /* Để dễ dàng chọn copy thủ công */
      color:var(--text-main);
      line-height:1.5;
    }
    
    .btn-copy{
      width:100%;
      background:var(--accent);
      color:#1a253a; /* Màu chữ đậm trên nền sáng */
      border:none;
      padding:15px 20px;
      border-radius:8px;
      cursor:pointer;
      font-weight:700;
      font-size:18px; /* Nút lớn, dễ bấm */
      transition:background 0.2s, transform 0.1s, box-shadow 0.3s;
      box-shadow:0 4px 15px rgba(0,229,255,0.4);
    }
    .btn-copy:hover:not(:disabled){
      background:var(--accent-hover);
      box-shadow:0 4px 20px rgba(0,229,255,0.6);
    }
    .btn-copy:active:not(:disabled){
        transform:scale(0.99);
    }
    .btn-copy:disabled{
        background:var(--text-muted);
        cursor:not-allowed;
        opacity:0.6;
        box-shadow:none;
    }

    /* Thông báo */
    .info-message{
        margin-top:15px;
        font-size:12px;
        color:var(--text-muted);
        text-align:left;
    }

    .btn-clear{
        font-size:13px;
        color:var(--text-muted);
        background:transparent;
        border:none;
        cursor:pointer;
        transition:color 0.2s;
        padding:5px;
    }
    .btn-clear:hover{
        color:var(--accent);
    }
    
    /* Mobile */
    @media (max-width: 600px) {
        h1{
            font-size:24px;
        }
        body{
            padding:15px;
        }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1><span style="color:#fff;">TÁCH</span> TOKEN VIP</h1>
    <p>Dán lệnh **cURL** hoặc **HTTP Headers** vào ô bên dưới để trích xuất nhanh giá trị **Authorization**.</p>

    <div class="card">
      <textarea id="curlInput" placeholder="Dán curl/headers vào đây... (Tự động tách sau khi dán/gõ)"></textarea>
    </div>

    <div class="card">
      <div class="output-label">
        <span>Giá trị Authorization đã trích xuất:</span>
        <button id="clearBtn" class="btn-clear">Xóa Input</button>
      </div>
      
      <div id="authOutput" class="auth-output" contenteditable="false">- Chưa có token -</div>
      
      <button id="copyBtn" class="btn-copy" disabled>SAO CHÉP TOKEN NGAY</button>
      
      <div id="rawInfo" class="info-message"></div>
    </div>
  </div>

  <script>
    const curlInput = document.getElementById('curlInput');
    const clearBtn = document.getElementById('clearBtn');
    const authOutput = document.getElementById('authOutput');
    const copyBtn = document.getElementById('copyBtn');
    const rawInfo = document.getElementById('rawInfo');

    /**
     * Hàm chính trích xuất giá trị Authorization.
     * Logic tìm kiếm token được giữ nguyên để đảm bảo độ chính xác.
     */
    function extractAuthorization(text){
      if(!text) return null;
      
      // 1) -H 'Authorization: ...'
      const regexHeader = /-H\s*['"]?\s*Authorization\s*[:|]\s*([^'"\\\n\r]+)['"]?/i;
      let m = text.match(regexHeader);
      if(m && m[1]) return m[1].trim();

      // 2) "Authorization": "..." (JSON)
      const jsonRegex = /"Authorization"\s*[:]\s*"([^"]+)"/i;
      m = text.match(jsonRegex);
      if(m && m[1]) return m[1].trim();

      // 3) Authorization: ... (Raw Header)
      const anyHeader = /Authorization\s*[:|]\s*([^\n\r;']+)/i;
      m = text.match(anyHeader);
      if(m && m[1]) return m[1].trim();

      // 4) Bearer token trực tiếp (Bearer ...)
      const bearer = /(Bearer\s+[A-Za-z0-9\-_.]+=*)/i;
      m = text.match(bearer);
      if(m && m[1]) return m[1].trim();

      // 5) JWT-like (khi dán mỗi token)
      const jwt = /([A-Za-z0-9\-_]+\.[A-Za-z0-9\-_]+\.[A-Za-z0-9\-_]+={0,2})/i;
      m = text.match(jwt);
      if(m && m[1]) return m[1].trim();

      return null;
    }

    /**
     * Hiển thị kết quả và cập nhật trạng thái nút Copy
     */
    function showResult(val){
      if(val && val.trim() !== ''){
        authOutput.textContent = val.trim();
        rawInfo.textContent = `Token ${val.length} ký tự. Nhấn nút Copy hoặc chọn thủ công.`;
        copyBtn.disabled = false;
        copyBtn.textContent = 'SAO CHÉP TOKEN NGAY';
      } else {
        authOutput.textContent = '- Không tìm thấy token -';
        rawInfo.textContent = 'Dán nội dung vào ô trên. Công cụ sẽ tự động tìm kiếm.';
        copyBtn.disabled = true;
        copyBtn.textContent = 'SAO CHÉP TOKEN NGAY';
      }
    }

    // Xử lý sự kiện Xóa
    clearBtn.addEventListener('click', ()=>{
      curlInput.value = '';
      showResult(null); // Reset trạng thái
    });

    // Xử lý sự kiện Sao chép
    copyBtn.addEventListener('click', async ()=>{
      const text = authOutput.textContent;
      if(copyBtn.disabled || text.startsWith('-')) return;

      try{
        await navigator.clipboard.writeText(text);
        copyBtn.textContent = 'ĐÃ SAO CHÉP THÀNH CÔNG! ✓';
        setTimeout(()=>{
          if(copyBtn.textContent === 'ĐÃ SAO CHÉP THÀNH CÔNG! ✓') {
            copyBtn.textContent = 'SAO CHÉP TOKEN NGAY';
          }
        }, 2000);
      }catch(e){
        // Fallback: Tự động chọn nội dung để người dùng copy thủ công
        authOutput.contentEditable = 'true'; 
        authOutput.focus();
        document.execCommand('selectAll');
        rawInfo.textContent = 'Tự động copy bị chặn. Token đã được chọn, vui lòng copy thủ công.';
        setTimeout(() => authOutput.contentEditable = 'false', 500); // Tắt editable sau khi chọn
      }
    });

    // Tự động Tách (Auto-parse) khi có thay đổi trong input
    let timeout;
    curlInput.addEventListener('input', ()=>{
      clearTimeout(timeout);
      timeout = setTimeout(()=>{
        const v = extractAuthorization(curlInput.value);
        showResult(v);
      }, 300);
    });

    // Tự động Tách khi dán từ clipboard
    curlInput.addEventListener('paste', ()=>{
      setTimeout(()=>{ 
        const v = extractAuthorization(curlInput.value); 
        showResult(v);
      }, 60);
    });

    // Load ban đầu
    window.addEventListener('load', ()=>{
      const v = extractAuthorization(curlInput.value);
      showResult(v);
    });
  </script>
</body>
</html>
